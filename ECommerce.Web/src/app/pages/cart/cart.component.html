<section class="py-4 bg-light">
  <div class="container">
    <div class="row">
      <!-- Cart Items -->
      <div class="col-lg-8">
        <div class="card shadow-sm p-3">
          <h2 class="mb-3">My Cart ({{ cartGrid.totalRecords }})</h2>

          <!-- Empty Cart -->
          <div *ngIf="cartItems.length === 0" class="text-center p-4">
            <img src="/assets/images/empty-cart.png" alt="Empty Cart" class="mb-3" style="width: 180px;">
            <p>Your cart is empty! Add items to proceed.</p>
            <a routerLink="/shop" class="btn btn-primary">Shop Now</a>
          </div>

          <!-- Cart List -->
          <div *ngFor="let item of cartItems" class="cart-item border-bottom d-flex p-3 align-items-center">
            <!-- Product Image -->
            <div class="cart-img me-3">
              <a [routerLink]="['/product-details', item.productId]">
                <img [src]="getProductImageUrl(item)" alt="{{ item.productName }}" class="rounded" style="width: 110px; height: 110px;">
              </a>
            </div>

            <!-- Product Info -->
            <div class="cart-info flex-grow-1">
              <h5 class="mb-1">
                <a class="text-dark text-decoration-none" [routerLink]="['/product-details', item.productId]">
                  {{ item.productName }}
                </a>
              </h5>
              <p class="text-muted small">SKU: {{ item.sku }}</p>

              <div class="d-flex align-items-center mt-2">
                <!-- Quantity Select -->
                <select class="form-select form-select-sm w-auto me-3" [(ngModel)]="item.quantity" (change)="updateQuantity(item, item.quantity)">
                  <option *ngFor="let q of [1,2,3,4,5,6,7,8,9,10]" [value]="q">{{ q }}</option>
                </select>

                <!-- Remove Button -->
                <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" [attr.data-bs-target]="'#removeConfirmModal' + item.productId">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
            </div>

            <!-- Price -->
            <div class="cart-price text-end">
              <p class="mb-1"><strong>₹{{ item.offerPrice || item.price }}</strong></p>
              <p class="text-success small">You save ₹{{ item.discountAmount || 0 }}</p>
              <p class="fw-bold">₹{{ item.totalPrice }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Price Details -->
      <div class="col-lg-4">
        <div class="card shadow-sm p-3">
          <h4 class="mb-3">Price Details</h4>
          <hr>
          <p class="d-flex justify-content-between">
            <span>Price ({{ cartGrid.totalRecords }} items)</span>
            <strong>₹{{ cartGrid.subTotal }}</strong>
          </p>
          <p class="d-flex justify-content-between text-success">
            <span>Discount</span>
            <strong>-₹{{ cartGrid.discount || 0 }}</strong>
          </p>
          <p class="d-flex justify-content-between">
            <span>Delivery Charges</span>
            <strong class="text-success">Free</strong>
          </p>
          <hr>
          <h5 class="d-flex justify-content-between">
            <span>Total Amount</span>
            <strong>₹{{ cartGrid.total }}</strong>
          </h5>
          <button class="btn btn-warning btn-lg w-100 mt-3" >
            Place Order
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div #cartToast class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          {{ toastMessage }}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- Remove Confirmation Modals -->
  <div *ngFor="let item of cartItems">
    <div class="modal fade" [id]="'removeConfirmModal' + item.productId" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Remove Item</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
            <p class="mb-3">Are you sure you want to remove this item?</p>
            <div class="d-flex justify-content-center gap-3">
              <button class="btn btn-danger" (click)="removeFromCart(item.productId)" data-bs-dismiss="modal">Remove</button>
              <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
