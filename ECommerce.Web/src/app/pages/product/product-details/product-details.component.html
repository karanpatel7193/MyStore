<div class="bg-color">
  <div class="container mt-5 py-3 row1" *ngFor="let product of product">
    <div class="row row1">
      <!-- Product Image Section -->
      <div class="col-md-6">
        <div class="product-image">
          <img [src]="selectedImage || product.url | imageUrlPipe" [alt]="product.name"
            class="img-fluid rounded main-product-image">
        </div>

        <div class="d-flex mt-3 justify-content-center border p-2 rounded">
          <img [src]="product.thumbUrl | imageUrlPipe" [alt]="product.name" class="thumbnail rounded mx-1"
            [class.active]="selectedImage === product.thumbUrl" (click)="changeImage((product.url))">
        </div>
      </div>
      <!-- Product Details Section -->
      <div class="col-md-6">
        <div class="card shadow-sm border rounded p-4">
          <h2 class="fw-bold mb-2">{{ product.name }}</h2>
          <p class="text-muted mb-2">SKU: {{ product.sku }}</p>
          <p class="text-muted mb-3">Category: {{ product.categoryName }}</p>
          <!-- Pricing -->
          <div class="mb-3 border-bottom pb-2">
            <span class="h4 text-primary fw-bold me-2">₹{{ product.finalSellPrice || product.sellPrice }}</span>
            <span class="text-muted text-decoration-line-through" *ngIf="product.discountPercentage">
              ₹{{ (product.finalSellPrice / (1 - product.discountPercentage / 100) | number:'1.2-2') }}
            </span>
            <span class="badge bg-danger ms-2" *ngIf="product.discountPercentage">
              {{ product.discountPercentage }}% OFF
            </span>
          </div>
          <!-- Description -->
          <p class="mb-4 text-secondary border-bottom pb-2">{{ product.description }}</p>
          <!-- Buttons -->
          <div class="mb-4 border-top pt-3 text-center row">
            <div class="col-4">
              <label for="quantity" class="form-label fw-bold">Quantity:</label>
              <input type="number" class="form-control w-50 d-inline-block border rounded" id="quantity"
                [(ngModel)]="quantity" min="1">
            </div>
            <div class="col-4">
              <button class="btn btn-primary btn-lg me-1 px-4" (click)="addToCart(product)">
                <i class="bi bi-cart-plus me-1"></i> Add to Cart
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-outline-secondary btn-lg px-2" (click)="addToWishlist(id)">
                <i class="bi bi-heart"></i> Add to Wishlist
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="SPECIFICATION">
          <!-- Specifications Section -->
          <div class="mb-4">
            <h5 class="fw-bold mb-3 border-bottom pb-2">Specifications</h5>
            <table class="table table-sm table-striped border rounded">
              <tbody>
                <tr *ngFor="let spec of productDetailsGridModel?.productDetailsSpecification">
                  <th class="text-muted">{{ spec.propertyName }}</th>
                  <td>{{ spec.value }} <span *ngIf="spec.unit">{{ spec.unit }}</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <!-- Product Variants -->
        <div class="product-card">
          <h2>Product Variants</h2>
          <div class="variant-section">
            <div *ngIf="productDetailsGridModel?.productVarient?.length" class="mb-4">
              <label class="fw-bold d-block mb-2 fs-6">
                {{ productDetailsGridModel.productVarient[0].variantPropertyName }}:
              </label>
              <div class="d-flex flex-wrap gap-2">
                <ng-container *ngFor="let variant of productDetailsGridModel.productVarient">
                  <input type="radio" class="btn-check" [id]="'variant-' + variant.variantPropertyValue"
                    [name]="'variant-group-' + variant.variantPropertyId" [value]="variant.variantPropertyValue"
                    [(ngModel)]="selectedVariants[variant.variantPropertyId]" (change)="onVariantSelected(variant)"
                    autocomplete="off" />
                  <label class="btn btn-outline-primary rounded-pill px-4 py-2"
                    [for]="'variant-' + variant.variantPropertyValue"
                    [ngClass]="{ 'active': selectedVariants[variant.variantPropertyId] === variant.variantPropertyValue }">
                    {{ variant.variantPropertyValue }}
                  </label>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
  </div>
</div>

<div class="container mt-4">
  <h2 class="fw-bold">Ratings & Reviews</h2>

  <!-- Overall Rating Summary -->
  <div class="d-flex align-items-center mt-3">
    <div class="display-4 fw-bold text-success">{{ averageRating || '0.0' }}</div>
    <div class="ms-3">
      <div class="mb-1 text-warning">
        <ng-container *ngFor="let star of [1,2,3,4,5]; let i = index">
          <span *ngIf="i < averageRating; else emptyStar">&#9733;</span>
          <ng-template #emptyStar>&#9734;</ng-template>
        </ng-container>
      </div>
      <p class="text-muted">{{ totalReviews }} Ratings & Reviews</p>
    </div>
  </div>

  <!-- Review Submission Form -->
  <div class="card p-4 shadow-sm mt-3">
    <h5 class="mb-3">Write a Review</h5>
    <form (submit)="submitReview(id)">
      <div class="mb-3">
        <label class="fw-bold">Rating:</label>
        <div class="star-rating">
          <input type="radio" id="star5" name="rating" [(ngModel)]="review.rating" [value]="5"><label
            for="star5">★</label>
          <input type="radio" id="star4" name="rating" [(ngModel)]="review.rating" [value]="4"><label
            for="star4">★</label>
          <input type="radio" id="star3" name="rating" [(ngModel)]="review.rating" [value]="3"><label
            for="star3">★</label>
          <input type="radio" id="star2" name="rating" [(ngModel)]="review.rating" [value]="2"><label
            for="star2">★</label>
          <input type="radio" id="star1" name="rating" [(ngModel)]="review.rating" [value]="1"><label
            for="star1">★</label>
        </div>
      </div>

      <div class="mb-3">
        <label class="fw-bold">Comment:</label>
        <textarea [(ngModel)]="review.comments" name="comments" class="form-control" placeholder="Write your review..."
          required></textarea>
      </div>

      <div class="mb-3">
        <label class="fw-bold">Upload Image:</label>
        <input type="file" (change)="handleFileInput($event)" multiple accept="image/*" class="form-control">
      </div>

      <button type="submit" class="btn btn-primary w-100">Submit Review</button>
    </form>
  </div>

  <!-- User Reviews Section -->
  <div class="mt-4">
    <h4 class="fw-bold">User Reviews</h4>
    <div *ngIf="reviews.length > 0; else noReviews">
      <div *ngFor="let review of reviews" class="card p-3 mb-3 shadow-sm">
        <div class="d-flex align-items-start">
          <div
            class="profile-initial bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
            {{ review.userName.charAt (0).toUpperCase() }}
          </div>
          <div>
            <h6 class="mb-1">{{ review.userName }}</h6>
            <div class="text-warning">
              <ng-container *ngFor="let star of [1,2,3,4,5]; let i = index">
                <span *ngIf="i < review.rating; else emptyStar">&#9733;</span>
                <ng-template #emptyStar>&#9734;</ng-template>
              </ng-container>
            </div>
            <p class="mb-1">{{ review.comments }}</p>
            <small class="text-muted">Reviewed On : {{ review.date | date: 'medium' }}</small>


            <!-- Show Images -->
            <div class="mt-2" *ngIf="review.mediaList.length > 0">
              <div class="d-flex flex-wrap">
                <img *ngFor="let media of review.mediaList" [src]="media.mediaURL" class="img-thumbnail me-2"
                  style="width: 100px; height: 100px; object-fit: cover;" alt="Review Image">
              </div>
            </div>

          </div>
          <div class="ms-auto">
            <button type="button" class="btn btn-link text-danger" (click)="delete(review.id)">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noReviews>
      <p class="text-muted">No reviews available.</p>
    </ng-template>
  </div>

</div>